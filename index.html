<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">CDH Project Connection</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        /* Inter Font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }

        /* Custom spinning animation */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-custom {
            animation: spin 1s linear infinite;
        }

        /* --- Connection Flow Wrapper (Responsive) --- */
        .connection-flow-wrapper {
            flex-direction: column; 
            gap: 1.5rem; 
        }
        
        @media (min-width: 768px) {
            .connection-flow-wrapper {
                flex-direction: row;
                gap: 0; 
                margin-left: 3rem; 
                margin-right: 3rem; 
            }
        }
        
        /* üåü 1. Verified SVG Style üåü */
        .verified-icon {
            display: inline-block;
            /* Adjust size to fit header text */
            width: 20px; /* Mobile size */
            height: 20px; /* Mobile size */
            margin-left: 5px;
            vertical-align: middle;
        }

        @media (min-width: 768px) {
            .verified-icon {
                width: 25px; /* Desktop size */
                height: 25px; /* Desktop size */
            }
        }
        
        /* --- Download Page Styles --- */
        :root {
            --primary-color: #0088cc;
            --success-color: #28a745;
        }
        .container.download-page-container { 
            max-width: 800px;  
            margin-top: 50px;  
            margin-bottom: 50px;
        }
        .download-box { 
            background: #ffffff; 
            border-radius: 10px; 
            padding: 20px; 
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1); 
        }
        @media (min-width: 768px) {
            .download-box {
                padding: 40px; 
            }
        }
        .btn-download { 
            background-color: var(--success-color); 
            border-color: var(--success-color); 
            font-size: 1.2rem; 
            padding: 12px 30px; 
            border-radius: 50px; 
            transition: background-color 0.3s ease, opacity 0.3s ease;
            width: 100%; 
        }
        .btn-download:hover { background-color: #218838; border-color: #1e7e34; }
        .btn-download.loading {
            background-color: #6c757d !important;
            pointer-events: none;
        }
        .loading-text { display: none; }
        .btn-download.loading .initial-text { display: none; }
        .btn-download.loading .loading-text { display: inline-block; }
        
        /* üåü C D H Corporation - Black Text üåü */
        .cdh-title { 
            color: black !important; 
            font-weight: 700; 
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .status-badge { font-size: 0.9rem; }
        .detail-row { padding: 5px 0; border-bottom: 1px solid #eee; }
        .detail-row:last-child { border-bottom: none; }
        
        /* ‡∂±‡∑Ä SVG icons ‡∑É‡∂≥‡∑Ñ‡∑è ‡∂±‡∑Ä CSS: detail-icon */
        .detail-row strong .detail-icon { 
            margin-right: 8px; 
            width: 18px; /* New icon size */
            height: 18px; /* New icon size */
            vertical-align: middle; 
            /* If you want the icon to match the text color, you can use CSS filter, but SVGs often look better in their original color:
            filter: invert(30%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(30%) contrast(100%); 
            */
        }
        
        /* ‡∂¥‡∑ê‡∂ª‡∂´‡∑í Font Awesome icon style ‡∂ë‡∂ö ‡∂â‡∑Ä‡∂≠‡∑ä ‡∂ö‡∂ª‡∂± ‡∂Ω‡∂Ø‡∑í:
        .detail-row strong i { margin-right: 8px; color: #495057; }
        */
        
        .thumb-img { max-width: 100%; height: auto; border-radius: 8px; margin-bottom: 20px; }

        /* üåü 2. Authentication GIF/Loading Container Style üåü */
        #authGifContainer {
            min-height: 20px; 
            margin-top: 20px;
        }

    </style>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-4">

<div id="connectionWrapper" class="flex flex-col items-center justify-center w-full max-w-4xl mx-auto py-10">

    <h1 class="text-3xl sm:text-4xl md:text-5xl font-extrabold mb-8 md:mb-12 text-center tracking-tight cdh-title">
        C D H Corporation
        <img class="verified-icon" 
             src="data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%0A%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22256%22%20height%3D%22256%22%3E%0A%3Cpath%20d%3D%22M0%200%20C3.33044526%201.77018786%206.55381992%203.69432172%209.78417969%205.63964844%20C14.49236352%208.44973596%2014.49236352%208.44973596%2019.79980469%208.58105469%20C20.74855469%208.06542969%2021.69730469%207.54980469%2022.67480469%207.01855469%20C23.24763184%206.71030762%2023.82045898%206.40206055%2024.41064453%206.08447266%20C26.94955613%204.69674874%2029.45111875%203.25251783%2031.93261719%201.76464844%20C36.76532921%20-0.96124078%2040.12159724%20-1.60349503%2045.67480469%20-0.98144531%20C48.76063743%200.06177655%2050.16416291%201.01914125%2051.65527344%203.9375%20C52.31206776%205.49973221%2052.96099916%207.06528649%2053.60327148%208.63354492%20C55.42633494%2012.90397449%2057.25412454%2016.80388565%2060.67480469%2020.01855469%20C65.91282279%2021.9592324%2071.26486851%2021.50034175%2076.74902344%2021.13964844%20C81.6567355%2020.85327917%2084.47604443%2021.39365579%2088.67480469%2024.01855469%20C92.70454756%2029.20082036%2092.01972987%2035.13691264%2091.86230469%2041.39355469%20C91.84876953%2042.41578125%2091.83523437%2043.43800781%2091.82128906%2044.49121094%20C91.78610685%2047.00087518%2091.73688008%2049.50943559%2091.67480469%2052.01855469%20C92.35285156%2052.26863281%2093.03089844%2052.51871094%2093.72949219%2052.77636719%20C97.22564572%2054.25087226%20100.50337637%2056.02673528%20103.79980469%2057.89355469%20C104.41984375%2058.23257813%20105.03988281%2058.57160156%20105.67871094%2058.92089844%20C112.05287024%2062.52606811%20112.05287024%2062.52606811%20113.67480469%2066.01855469%20C115.23178139%2074.46655501%20111.27724903%2080.20185482%20107.05371094%2087.17675781%20C104.24154611%2091.85790799%20104.24154611%2091.85790799%20104.11230469%2097.14355469%20C104.62792969%2098.09230469%20105.14355469%2099.04105469%20105.67480469%20100.01855469%20C105.98305176%20100.58614502%20106.29129883%20101.15373535%20106.60888672%20101.73852539%20C107.29150928%20102.97439853%20107.98813301%20104.2026267%20108.69750977%20105.42333984%20C115.21038565%20116.69501473%20115.21038565%20116.69501473%20113.67480469%20124.01855469%20C110.02535657%20128.32214916%20105.79787024%20131.02683558%20100.98730469%20133.83105469%20C100.31119141%20134.23775391%2099.63507813%20134.64445313%2098.93847656%20135.06347656%20C93.94712612%20138.01855469%2093.94712612%20138.01855469%2091.67480469%20138.01855469%20C91.69837036%20139.02438599%2091.69837036%20139.02438599%2091.72241211%20140.05053711%20C91.78495127%20143.10228979%2091.82385532%20146.15390737%2091.86230469%20149.20605469%20C91.88744141%20150.26115234%2091.91257813%20151.31625%2091.93847656%20152.40332031%20C91.95297852%20153.93569336%2091.95297852%20153.93569336%2091.96777344%20155.49902344%20C91.99133911%20156.90510864%2091.99133911%20156.90510864%2092.01538086%20158.33959961%20C91.60544291%20161.56415093%2090.56715219%20163.39751385%2088.67480469%20166.01855469%20C84.02502094%20169.41925057%2080.29701557%20169.06379831%2074.83081055%20168.72314453%20C69.93960874%20168.48398806%2065.33888485%20168.36905188%2060.67480469%20170.01855469%20C56.55097063%20173.78936754%2054.62996041%20178.73179588%2052.57714844%20183.82324219%20C51.39693676%20186.6874519%2050.75340246%20187.94610805%2048.42871094%20190.08886719%20C43.7064973%20191.68303293%2039.92889804%20191.96998846%2035.34960938%20190.03710938%20C32.01916411%20188.26692151%2028.79578946%20186.34278766%2025.56542969%20184.39746094%20C20.85724585%20181.58737342%2020.85724585%20181.58737342%2015.54980469%20181.45605469%20C14.60105469%20181.97167969%2013.65230469%20182.48730469%2012.67480469%20183.01855469%20C12.10197754%20183.32680176%2011.52915039%20183.63504883%2010.93896484%20183.95263672%20C8.40005324%20185.34036064%205.89849063%20186.78459154%203.41699219%20188.27246094%20C-1.41571984%20190.99835016%20-4.77198786%20191.6406044%20-10.32519531%20191.01855469%20C-13.08300781%20190.08886719%20-13.08300781%20190.08886719%20-15.32519531%20188.01855469%20C-16.39410056%20185.85542513%20-17.26259933%20183.64627226%20-18.15234375%20181.40380859%20C-19.96386645%20177.06408901%20-21.76781626%20173.18499352%20-25.32519531%20170.01855469%20C-31.12452763%20168.08038531%20-37.04401642%20168.617706%20-43.05957031%20168.99511719%20C-46.96287805%20169.19370653%20-48.24705472%20169.05626008%20-51.90332031%20167.29199219%20C-54.89710302%20164.48169938%20-56.18746269%20162.57478523%20-56.55224609%20158.453125%20C-56.54177246%20157.51049805%20-56.53129883%20156.56787109%20-56.52050781%20155.59667969%20C-56.5140625%20154.571875%20-56.50761719%20153.54707031%20-56.50097656%20152.49121094%20C-56.48421875%20151.42773438%20-56.46746094%20150.36425781%20-56.45019531%20149.26855469%20C-56.44117187%20148.18960938%20-56.43214844%20147.11066406%20-56.42285156%20145.99902344%20C-56.39930836%20143.33864191%20-56.3664233%20140.67871133%20-56.32519531%20138.01855469%20C-57.07913574%20137.72577637%20-57.83307617%20137.43299805%20-58.60986328%20137.13134766%20C-62.04015177%20135.72555239%20-65.23035466%20133.96700129%20-68.45019531%20132.14355469%20C-69.38025391%20131.63501953%20-69.38025391%20131.63501953%20-70.32910156%20131.11621094%20C-76.70326087%20127.51104127%20-76.70326087%20127.51104127%20-78.32519531%20124.01855469%20C-79.88217202%20115.57055436%20-75.92763966%20109.83525455%20-71.70410156%20102.86035156%20C-68.8875175%2098.16395181%20-68.8875175%2098.16395181%20-68.76269531%2092.85839844%20C-70.22458524%2090.20141349%20-71.72519716%2087.58283309%20-73.34790039%2085.02026367%20C-76.79945362%2079.53523723%20-79.22100581%2074.82606874%20-79.09472656%2068.20214844%20C-77.00420934%2062.27017318%20-70.79111035%2059.21013076%20-65.63769531%2056.20605469%20C-64.62352539%2055.59600586%20-64.62352539%2055.59600586%20-63.58886719%2054.97363281%20C-58.59751674%2052.01855469%20-58.59751674%2052.01855469%20-56.32519531%2052.01855469%20C-56.34090576%2051.34800049%20-56.35661621%2050.67744629%20-56.37280273%2049.98657227%20C-56.43534189%2046.93481959%20-56.47424595%2043.88320201%20-56.51269531%2040.83105469%20C-56.53783203%2039.77595703%20-56.56296875%2038.72085938%20-56.58886719%2037.63378906%20C-56.59853516%2036.61220703%20-56.60820313%2035.590625%20-56.61816406%2034.53808594%20C-56.63387451%2033.6006958%20-56.64958496%2032.66330566%20-56.66577148%2031.69750977%20C-56.25414879%2028.45970629%20-55.25193121%2026.63461637%20-53.32519531%2024.01855469%20C-48.22477494%2020.93473184%20-44.58996778%2020.92980546%20-38.74902344%2021.31396484%20C-34.09151851%2021.55581601%20-29.74625113%2021.65654912%20-25.32519531%2020.01855469%20C-21.2765513%2016.21374103%20-19.33394597%2011.27131121%20-17.26269531%206.21386719%20C-16.06382818%203.36227608%20-15.39701542%202.08463917%20-13.07519531%20-0.05175781%20C-8.35501355%20-1.64750108%20-4.5776064%20-1.93216902%200%200%20Z%20%22%20fill%3D%22%231800FE%22%20transform%3D%22translate(110.3251953125%2C32.9814453125)%22%2F%3E%0A%3Cpath%20d%3D%22M0%200%20C0.99%200.99%200.99%200.99%202%202%20C1.88857353%207.37938296%20-0.40632585%2010.12730268%20-4.08300781%2013.72998047%20C-4.61156876%2014.26730301%20-5.1401297%2014.80462555%20-5.68470764%2015.35823059%20C-7.42851069%2017.12397105%20-9.18988596%2018.8708711%20-10.953125%2020.6171875%20C-12.17356381%2021.84099553%20-13.39325966%2023.06554489%20-14.61224365%2024.290802%20C-17.16655045%2026.8524721%20-19.72966162%2029.40490065%20-22.29931641%2031.95117188%20C-25.59289842%2035.21623715%20-28.86348318%2038.50327799%20-32.12782669%2041.79754448%20C-34.64096716%2044.32874629%20-37.16588737%2046.84792577%20-39.69454193%2049.36362076%20C-40.90547575%2050.57121895%20-42.11270571%2051.78254302%20-43.31613922%2052.99761581%20C-44.99876475%2054.69293334%20-46.69657571%2056.37140574%20-48.39941406%2058.04638672%20C-48.89415726%2058.55125107%20-49.38890045%2059.05611542%20-49.89863586%2059.57627869%20C-52.10911221%2061.72019089%20-53.58037542%2062.92551979%20-56.6481781%2063.47003174%20C-59.31062939%2062.93791806%20-60.31296234%2062.32328392%20-62.22973633%2060.43310547%20C-62.80996048%2059.87186981%20-63.39018463%2059.31063416%20-63.98799133%2058.73239136%20C-64.59652451%2058.11687408%20-65.20505768%2057.50135681%20-65.83203125%2056.8671875%20C-66.46864182%2056.23773224%20-67.10525238%2055.60827698%20-67.76115417%2054.95974731%20C-69.10278577%2053.62589475%20-70.43805046%2052.28561185%20-71.76733398%2050.93945312%20C-73.80363044%2048.8839532%20-75.86749851%2046.85942965%20-77.93554688%2044.835...
             " 
             alt="Verified Icon">
        <span class="badge bg-success status-badge ms-2">File Downloader</span>
    </h1>

    <div id="statusContainer" class="flex connection-flow-wrapper items-center justify-center my-6 text-center">
        </div>

    <div id="authGifContainer" class="text-center min-h-[20px] max-w-xl mx-auto mb-4">
        </div>
    
    <p id="resultMessage" class="text-center text-sm md:text-base text-gray-700 max-w-xl mx-auto mb-10">
        </p>


    <div id="downloadWrapper" class="container download-page-container d-none">
        <div class="download-box">
            
            <h2 class="text-3xl font-bold mb-4 text-center text-dark">Video File</h2>

            <div class="thumbnail-placeholder text-center mb-4">
                <img id="thumbnailImage" class="thumb-img mx-auto d-none" src="" alt="Video Thumbnail">
                <div id="thumbnailFallback" class="bg-light text-center py-5 rounded-lg text-gray-500 text-sm">
                    No thumbnail available.
                </div>
            </div>

            <div id="videoDetails" class="">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800" id="videoTitle">Video File</h3>

                <div class="list-group list-group-flush">
                    
                    <div class="list-group-item detail-row bg-transparent">
                        <strong class="text-gray-600">
                            <img class="detail-icon" src="https://envs.sh/-Uf.svg" alt="Uploader Icon"> 
                            Uploader:
                        </strong> 
                        <span id="uploaderText" class="text-gray-800">N/A</span>
                    </div>

                    <div class="list-group-item detail-row bg-transparent">
                        <strong class="text-gray-600">
                            <img class="detail-icon" src="https://envs.sh/-Ua.svg" alt="Duration Icon"> 
                            Duration:
                        </strong> 
                        <span id="durationText" class="text-gray-800">N/A</span>
                    </div>

                    <div class="list-group-item detail-row bg-transparent">
                        <strong class="text-gray-600">
                            <img class="detail-icon" src="https://envs.sh/-UO.svg" alt="Views Icon"> 
                            Views:
                        </strong> 
                        <span id="viewsText" class="text-gray-800">N/A</span>
                    </div>

                    <div class="list-group-item detail-row bg-transparent">
                        <strong class="text-gray-600">
                            <img class="detail-icon" src="https://envs.sh/-Um.svg" alt="Upload Date Icon"> 
                            Upload Date:
                        </strong> 
                        <span id="uploadDateText" class="text-gray-800">N/A</span>
                    </div>
                </div>

                <div class="mt-5">
                    <button id="downloadButton" class="btn btn-download btn-lg initial-text">
                        <i class="fas fa-download me-2"></i> Download Video
                        <span class="loading-text">
                            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                            Downloading...
                        </span>
                    </button>
                    <p class="text-center text-muted mt-2 text-sm">Click the button to start the direct download.</p>
                </div>
            </div>

            <div id="errorState" class="alert alert-danger d-none mt-4 text-center" role="alert">
                </div>
        </div>
    </div>


</div>


<script>
    // Base64 decoding utility (defined in original script)
    const decodeBase64 = (encoded) => { 
        if (!encoded) return 'N/A';
        try { 
            // Ensures compatibility with URI components
            return decodeURIComponent(escape(atob(encoded))); 
        } catch (e) { 
            console.error("Base64 decoding failed:", e);
            return 'N/A'; 
        } 
    };
    
    document.addEventListener('DOMContentLoaded', function() {
        const connectionWrapper = document.getElementById('connectionWrapper');
        const downloadWrapper = document.getElementById('downloadWrapper');
        const statusContainer = document.getElementById('statusContainer');
        const resultMessage = document.getElementById('resultMessage');
        const authGifContainer = document.getElementById('authGifContainer');
        const pageTitle = document.getElementById('pageTitle');
        
        // --- Connection Flow Content (Unchanged) ---
        const connectingIcon = ` 
            <svg class="w-8 h-8 md:w-10 md:h-10 text-yellow-500 animate-spin-custom" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 4.75V6.25" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M17.1266 6.87347L16.0659 7.93413" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M19.25 12L17.75 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M17.1266 17.1265L16.0659 16.0659" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 17.75V19.25" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M7.93413 16.0659L6.87347 17.1266" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M6.25 12L4.75 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M7.93413 7.93413L6.87347 6.87347" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            `;
        const connectingText = '<p class="text-base md:text-xl font-extrabold text-yellow-600 border-b-4 border-yellow-500 pb-1 px-2">CONNECTING...</p>';
        
        const approvedIcon = ` 
            <svg class="w-8 h-8 md:w-10 md:h-10 text-green-500 bg-green-100 rounded-full p-1 shadow-inner transition duration-500 transform scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> 
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path> 
            </svg> 
            `;
        const approvedText = '<p class="text-base md:text-xl font-extrabold text-green-600 border-b-4 border-green-500 pb-1 px-2">APPROVED</p>';

        // üåü Authentication GIF Placeholder üåü
        const authGifHtml = ` 
            <div class="spinner-border spinner-border-sm text-primary" role="status"> 
                <span class="visually-hidden">Loading...</span> 
            </div> 
            <span class="text-xs sm:text-sm text-indigo-600 font-medium ms-2">Authentication in progress...</span> 
            `;

        // --- Download Page Script Logic (Unchanged) ---
        const params = new URLSearchParams(window.location.search);
        const urlParam = params.get('url');
        const titleParam = params.get('title');
        const uploaderParam = params.get('uploader');
        const durationParam = params.get('duration');
        const viewsParam = params.get('views');
        const dateParam = params.get('date');
        const thumbParam = params.get('thumb');

        const loadingState = document.getElementById('loadingState');
        const videoDetails = document.getElementById('videoDetails');
        const errorState = document.getElementById('errorState');
        const videoTitle = document.getElementById('videoTitle');
        const downloadButton = document.getElementById('downloadButton');
        const uploaderText = document.getElementById('uploaderText');
        const durationText = document.getElementById('durationText');
        const viewsText = document.getElementById('viewsText');
        const uploadDateText = document.getElementById('uploadDateText');
        const thumbnailImage = document.getElementById('thumbnailImage');
        const thumbnailFallback = document.getElementById('thumbnailFallback');

        let decodedUrl = '';
        let decodedTitle = 'Video File';

        // Download Initiation Function (Fixed)
        const initiateDownload = (url, title) => {
            downloadButton.classList.add('loading');
            downloadButton.classList.add('w-100');
            // Using a temporary invisible anchor tag to trigger download
            const link = document.createElement('a');
            link.href = url;
            // Use title as filename hint, ensuring it's not 'N/A'
            if (title && title !== 'N/A') {
                link.download = title + '.mp4'; 
            }
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            // Revert button state (optional, depending on desired behavior)
            setTimeout(() => {
                // downloadButton.classList.remove('loading');
            }, 3000); 
        };

        // Main function to load details
        const loadDownloadDetails = () => {
            if (urlParam) {
                // Decode main parameters
                decodedUrl = decodeBase64(urlParam);
                let title = decodeBase64(titleParam) || 'Video File';
                decodedTitle = title;
                
                // Decode and set detail parameters
                uploaderText.textContent = decodeBase64(uploaderParam);
                durationText.textContent = decodeBase64(durationParam);
                viewsText.textContent = decodeBase64(viewsParam);
                uploadDateText.textContent = decodeBase64(dateParam);
                videoTitle.textContent = title;
                pageTitle.textContent = title;

                // Handle Thumbnail
                let decodedThumb = decodeBase64(thumbParam);
                if (decodedThumb && decodedThumb !== 'N/A') {
                    thumbnailImage.src = decodedThumb;
                    thumbnailImage.classList.remove('d-none');
                    thumbnailFallback.classList.add('d-none');
                } else {
                    thumbnailImage.classList.add('d-none');
                    thumbnailFallback.classList.remove('d-none');
                }

                videoDetails.classList.remove('d-none');
                
                // Attach download handler
                downloadButton.onclick = () => initiateDownload(decodedUrl, decodedTitle);

                // Check if decoding failed (e.g., if any returned 'N/A' unexpectedly)
                if (decodedUrl === 'N/A' || decodedTitle === 'N/A') {
                    videoDetails.classList.add('d-none');
                    errorState.classList.remove('d-none');
                    errorState.textContent = "Could not decode the download link details.";
                }

            } else {
                loadingState.classList.add('d-none');
                videoDetails.classList.add('d-none');
                errorState.textContent = "Please use the Telegram Bot to generate a valid download link.";
                errorState.classList.remove('d-none');
                pageTitle.textContent = "Error Loading Link";
            }
        };

        // --- Main Connection Logic (Transition) ---
        const startConnection = () => {
            statusContainer.innerHTML = connectingIcon + connectingText;
            
            // üåü Use GIF Placeholder in Container üåü
            resultMessage.classList.add('d-none'); // Hide the message text
            authGifContainer.innerHTML = authGifHtml; // Show GIF placeholder
            
            setTimeout(() => {
                statusContainer.innerHTML = approvedIcon + approvedText;
                
                // Switch to success message after approval
                authGifContainer.innerHTML = '<p class="mt-4 text-center text-xs sm:text-sm font-bold text-green-600 min-h-[20px] max-w-xl">Connection established successfully. Project is authorized. Loading Download Page...</p>';
                
                setTimeout(() => {
                    connectionWrapper.classList.add('d-none'); 
                    downloadWrapper.classList.remove('d-none'); 

                    document.body.classList.remove('flex', 'items-center', 'justify-center', 'min-h-screen', 'p-4', 'bg-gray-50');
                    document.body.classList.add('bg-light'); 

                    loadDownloadDetails();
                }, 1000); 
            }, 5000); 
        };

        // Start the process
        startConnection();
    });
</script>

</body>
</html>
